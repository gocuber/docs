<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

	
<title>CubePHP框架 —— 更好、更快、更强的PHP开发框架 - CubePHP官方网站</title>
<meta name="keywords" content="CubePHP框架,CubePHP,PHP框架,MVC框架,PHPMVC框架,CubePHP框架 —— 更好、更快、更强的PHP开发框架 - CubePHP官方网站">
<meta name="description" content="CubePHP框架,CubePHP,PHP框架,MVC框架,PHPMVC框架,CubePHP框架 —— 更好、更快、更强的PHP开发框架 - CubePHP官方网站">
<link href="/res/cube/css/style.css" rel="stylesheet" type="text/css" />

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?2df9ce934dc484bd6d51074b34da2854";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>





</head>
<body>


<div class="cube-container cube-header">
	<div class="site">
		<div class="title"><a href="http://www.gocuber.com/" title="CubePHP框架">CubePHP框架</a><em>Beta</em></div>
		<div class="subtitle">—— 更好、更快、更强的PHP开发框架</div>
	</div>
	<div class="logo"><a href="http://www.gocuber.com/" title="CubePHP"><img src="/res/cube/images/logo1.jpg" alt="CubePHP" /></a></div>
</div>

<div class="cube-nav">
	<div class="cube-container">
		<div class="cube-nav-brand"><a href="http://www.gocuber.com/">Cube</a></div>
		<div class="cube-nav-toggle"><div><span></span><span></span><span></span></div></div>
		<div class="cube-navbar">
			<ul class="cube-nav-left">
				<li><a href="http://www.gocuber.com/" title="CubePHP框架官方首页">首页</a></li>
				<li><a href="http://www.gocuber.com/download/" title="CubePHP框架下载">下载</a></li>
				<li><a href="http://www.gocuber.com/guide/" title="CubePHP框架开发文档" class="active">开发文档</a></li>
				<li><a href="http://www.gocuber.com/code/" title="CubePHP框架相关代码">代码</a></li>
				<li><a href="http://www.gocuber.com/extend/" title="CubePHP框架扩展">扩展</a></li>
				<li><a href="http://www.gocuber.com/demo/" title="CubePHP框架演示">演示</a></li>
			</ul>
			
		</div>
	</div>
	<div class="cube-clear"></div>
</div>

<div class="cube-container">
<div class="cube-breadcrumb">
	<a href="http://www.gocuber.com/">首页</a>
	 &raquo; <a href="http://www.gocuber.com/guide/">开发文档</a> &raquo; 数据库模型(model)的使用</div>
</div>

<div class="cube-container cube-change-layout">

    <div class="cube-big-layout cube-guide">
    <div class="cube-block">
		<div class="cube-title">数据库模型(model)的使用</div>
		<div class="h1">数据库模型(model)的使用</div>

<ul class="cube-catalog">
	<li><a href="#text"># 介绍</a></li>
	<li><a href="#users"># 创建model</a></li>
	<li><a href="#extends"># 简化写法</a></li>
	<li><a href="#model"># model的使用 DB::model()</a></li>
	<li><a href="#field"># getFields() 方法</a></li>
	<li><a href="#preparedata"># prepareData() 准备数据</a></li>
	<li><a href="#settablename"># setTableName() 设置分表</a></li>
</ul>

<div class="h2"><a name="text">#</a> 介绍</div>

<p class="text">
　　Model 模型 是应用程序中用于处理应用程序数据逻辑的部分；<br />
　　通常模型负责在数据库中存取数据；<br />
　　一般情况下，一个数据库表对应一个 model 类文件；<br />
<br />
　　使用 DB::model('user') 来调用model类文件；<br />
　　DB::model('User') 这里的User并不是表名称；而是对应一个model目录中的类文件；<br />
　　注：CubePHP框架中提供一个函数方法 M(); 等同于DB::model(); 所以也可以使用 M('User'); 来调用model类文件；<br />
<br />
<br />
　　举例说明；<br />
<br />
　　库名：ucenter    用户中心库<br />
　　表名：uc_user    用户表<br />
　　表名：uc_group   用户组表<br />
</p>


<div class="h2"><a name="users">#</a> 创建model</div>
<p class="text">
　　新建 Uc 目录用于存放用户中心库下所有的表 model 类文件；<br />
　　新建用户表 model 类 User.php 保存到 models/Uc/ 目录中；<br />
<br />
　　代码如下：
</p>


<pre class="brush: php;">

	class Uc_User extends DB               // 继承DB类
	{

		public $_dbname     = 'ucenter';   // 数据库名称
		public $_name       = 'uc_user';   // 表名称
		public $_primarykey = 'id';        // 如果有主键；主键字段名称

		public function getConfig()
		{
			return $GLOBALS['_G']['db']['user'];      //数据库配置
		}

	}

</pre>
<p class="text">　　接下来就可以 DB::model('Uc_User') 这样使用了；注：Uc_User 对应的是 model 类名；</p>


<p class="text">　　新建用户组表 model 类 Group.php 保存到 models/Uc/ 目录中；如下：</p>
<pre class="brush: php;">

	class Uc_Group extends DB
	{

		public $_dbname     = 'ucenter';
		public $_name       = 'uc_group';
		public $_primarykey = 'id';

		public function getConfig()
		{
			return $GLOBALS['_G']['db']['user'];
		}

	}

</pre>


<div class="h2"><a name="extends">#</a> 简化写法</div>
<p class="text">
　　为了简化写法；可以给每个数据库建立一个类；统一放到 models/DB/ 目录中；库中所有表继承这个类；如：<br /><br />
　　新建 Ucenter.php 保存到 models/DB/ 目录中；
</p>
<pre class="brush: php;">

	class DB_Ucenter extends DB
	{

		public $_dbname     = 'ucenter';
		public function getConfig()
		{
			return $GLOBALS['_G']['db']['user'];
		}

	}

</pre>

<p class="text">　　前面的表 model 类 Uc_User Uc_Group 可以改写成：</p>
<pre class="brush: php;">

	class Uc_User extends DB_Ucenter
	{
		public $_name       = 'uc_user';
		public $_primarykey = 'id';
		// ..
	}

	class Uc_Group extends DB_Ucenter
	{
		public $_name       = 'uc_group';
		public $_primarykey = 'id';
		// ..
	}

</pre>



<div class="h2"><a name="model">#</a> model的使用 DB::model()</div>
<p class="text">　　使用 DB::model('Uc_User') 直接操作用户表；不用再使用 connect() 方法连库；也不用使用 name() 方法指定表名；如下：</p>
<pre class="brush: php;">

	DB::model('Uc_User')->get();

	DB::model('Uc_User')->where()->line();

	DB::model('Uc_User')->val('name');

	DB::model('Uc_User')->delete();

	DB::model('Uc_User')->update();

	// ...
</pre>

<p class="text">
　　DB::model('Uc_User') 相当于前面的 DB::connect()->name('user')<br />
　　get() line() delete() update() 等方法用法同前面讲的一样；<br />
　　还可以直接使用 M() 函数来调用 model ；如下：
</p>

<pre class="brush: php;">

	M('Uc_User')->get();

	M('Uc_User')->where()->line();

	M('Uc_User')->val('name');

	M('Uc_User')->delete();

	M('Uc_User')->update();

	// ...
</pre>



<div class="h2"><a name="field">#</a> getFields() 方法</div>
<p class="text">　　在 model 类中可以写 getFields() 方法；来指定表字段；如下：</p>
<pre class="brush: php;">

	class Uc_User extends DB_Ucenter
	{
		protected $_name       = 'uc_user';
		protected $_primarykey = 'id';

		public function getFields()
		{
			$fields = array(
				'id',            // 用户id
				'username',      // 账号
				'password',      // 密码
				'status',        // 状态
				'is_sys',        // 是否系统用户
				'is_super',      // 是否超级管理员
				'mobile',        // 手机
				'email',         // email
				'name',          // 姓名
				'nickname',      // 昵称
				'lastlogintime', // 最后登录时间
				'lastloginip',   // 最后登录IP
				'createtime',    // 创建时间
				'updatetime',    // 更新时间
			);
			return $fields;
		}
	}

</pre>


<div class="h2"><a name="preparedata">#</a> prepareData() 准备数据</div>
<p class="text">　　在 model 类中可以定义 prepareData() 方法；来为 insert() update() 等操作准备数据；如下：</p>
<pre class="brush: php;">

	class Uc_User extends DB_Ucenter
	{
		// ...

		/**
		 * 准备数据
		 *
		 * @param array $array
		 * @return array
		 */
		protected function prepareData(array $array)
		{
			$array = array_change_key_case($array, CASE_LOWER); // 转小写

			$fields = $this->getFields();
			if(empty($fields) or !is_array($fields)){
				return $array;
			}

			$data = array();
			// ...

			return $data;
		}
	}

</pre>


<div class="h2"><a name="settablename">#</a> setTableName() 设置分表</div>
<p class="text">　　可以定义 setTableName() 方法；来实现数据库分表；如下：</p>
<pre class="brush: php;">

	class Uc_User extends DB_Ucenter
	{
		// ...

		public function setTableName()
		{
			// 根据具体的业务需求来定义分表

			// $tablename = 'log_' . date('Ymd');
			// $tablename = 'stat_' . date('Ymd');
			// $tablename = 'md5_' . substr(md5('abc'), -2);

			$this->_name = $tablename;
			return $this;
		}
	}

</pre>


<br /><br /><br /><br />	</div>
	</div><!-- /big -->

	
    <div class="cube-small-layout">
    <div class="cube-block">

    		<div class="cube-title">开发文档</div>
		<ul class="cube-menu">
		<li>开始</li><ul><li><a href="http://www.gocuber.com/guide/about/">简介</a></li><li><a href="http://www.gocuber.com/guide/down/">下载和安装</a></li><li><a href="http://www.gocuber.com/guide/app/">创建第一个应用</a></li></ul><li>基础知识</li><ul><li><a href="http://www.gocuber.com/guide/directory/">目录结构</a></li><li><a href="http://www.gocuber.com/guide/entrance/">入口文件</a></li><li><a href="http://www.gocuber.com/guide/urlmodel/">URL模式</a></li><li><a href="http://www.gocuber.com/guide/rewrite/">URL重写</a></li><li><a href="http://www.gocuber.com/guide/controller/">Controller 控制器</a></li><li><a href="http://www.gocuber.com/guide/view/">View 视图模板</a></li><li><a href="http://www.gocuber.com/guide/model/">Model 模型</a></li><li><a href="http://www.gocuber.com/guide/module/">Module 模块</a></li><li><a href="http://www.gocuber.com/guide/route/">URL路由</a></li><li><a href="http://www.gocuber.com/guide/autoload/">类自动加载</a></li><li><a href="http://www.gocuber.com/guide/rule/">开发规范</a></li></ul><li>数据库</li><ul><li><a href="http://www.gocuber.com/guide/dbbase/">数据库配置与使用基础</a></li><li><a href="http://www.gocuber.com/guide/dbquery/">数据库查询结构器</a></li><li><a href="http://www.gocuber.com/guide/dbmodel/">数据库模型(model)的使用</a></li><li><a href="http://www.gocuber.com/guide/dbtransaction/">数据库事务处理</a></li></ul><li>缓存</li><ul><li><a href="http://www.gocuber.com/guide/memcache/">Memcache</a></li><li><a href="http://www.gocuber.com/guide/redis/">Redis</a></li><li><a href="http://www.gocuber.com/guide/filecache/">文件缓存</a></li><li><a href="http://www.gocuber.com/guide/cachesession/">使用缓存存储SESSION</a></li></ul><li>搜索引擎</li><ul><li><a href="http://www.gocuber.com/guide/elasticsearch/">Elasticsearch</a></li></ul><li>类库及函数</li><ul><li><a href="http://www.gocuber.com/guide/func/">系统函数说明</a></li><li><a href="http://www.gocuber.com/guide/class/">系统类库说明</a></li><li><a href="http://www.gocuber.com/guide/session/">SESSION使用</a></li><li><a href="http://www.gocuber.com/guide/cookie/">COOKIE使用</a></li></ul><li>CLI命令行</li><ul><li><a href="http://www.gocuber.com/guide/cli/">以命令行方式运行</a></li></ul><li>扩展</li><ul><li><a href="http://www.gocuber.com/guide/smarty/">使用Smarty</a></li><li><a href="http://www.gocuber.com/guide/lib/">使用第三方库</a></li><li><a href="http://www.gocuber.com/guide/sae/">SAE环境下开发</a></li></ul>		</ul>
	
    </div>
    </div><!-- /small -->

</div><!-- /cube-container -->


	<div class="cube-container cube-footer">
		<a href="#">意见反馈</a><br />
		版权所有 <span>&copy;</span> 2012-2018 goCuber.com Powered by <a href="http://www.gocuber.com/">CubePHP</a>
	</div>
	<div class="cube-top">TOP</div>
	

<script language="javascript" type="text/javascript">
/* 全局变量 */
var G = {
	'cubeUrl' : 'http://www.gocuber.com/',
	'resUrl' : '/res/',
	'apiUrl' : 'http://api.gocuber.com/',
	'publicKey' : 0
};
</script>

<div class="cube-dn"><script src="https://s19.cnzz.com/z_stat.php?id=1272829783&web_id=1272829783" language="JavaScript"></script></div>

<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="/res/global/js/jquery.cookie.js"></script>
<script src="/res/global/js/rsa/BigInt.js"></script>
<script src="/res/global/js/rsa/Barrett.js"></script>
<script src="/res/global/js/rsa/RSA.js"></script>
<script src="/res/cube/js/global.js"></script>
<script src="/res/cube/js/user.js"></script>

<script src="/res/global/js/syntaxhighlighter_2.1.382/scripts/shCore.js"></script>
<script src="/res/global/js/syntaxhighlighter_2.1.382/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="/res/global/js/syntaxhighlighter_2.1.382/styles/shCore.css"/>
<link type="text/css" rel="stylesheet" href="/res/global/js/syntaxhighlighter_2.1.382/styles/shThemeDefault.css"/>
<script type="text/javascript">
SyntaxHighlighter.config.clipboardSwf = '/res/global/js/syntaxhighlighter_2.1.382/scripts/clipboard.swf';
SyntaxHighlighter.all();
</script>

</body>
</html>
